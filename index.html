<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第一視角：睡前任務</title>
    <style>
        :root { --bg-color: #f0f0f0; }
        body { margin: 0; font-family: sans-serif; overflow: hidden; }
        
        /* 房間場景容器 */
        #room-scene {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #87CEEB; /* 這裡之後可以換成房間的底圖 */
            transition: background 1s, filter 1s;
        }

        /* 任務計數器 */
        #task-counter {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 20px;
            font-weight: bold;
            z-index: 100;
        }

        /* 驚嘆號樣式 */
        .exclamation {
            position: absolute;
            cursor: pointer;
            font-size: 40px;
            color: #ff3e3e;
            font-weight: bold;
            animation: bounce 0.5s infinite alternate;
            display: none; /* 預設隱藏 */
        }

        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }

        /* 彈出任務視窗 */
        #task-modal {
            display: none;
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            z-index: 200;
            text-align: center;
        }

        /* 昏暗效果 */
        .dark { background: #000033 !important; filter: brightness(0.4); }
        .sleep-mode { background: #000 !important; filter: brightness(0); }
    </style>
</head>
<body>

<div id="task-counter">任務進度: <span id="count">0</span>/3</div>

<div id="room-scene">
    <div id="desk" class="exclamation" style="top: 50%; left: 20%;">❗<br><small style="font-size:12px">書桌</small></div>
    <div id="bed" class="exclamation" style="top: 60%; left: 70%;">❗<br><small style="font-size:12px">床</small></div>
    <div id="bath" class="exclamation" style="top: 40%; left: 80%;">❗<br><small style="font-size:12px">浴室</small></div>
    <div id="light-switch" class="exclamation" style="top: 30%; left: 10%;">❗<br><small style="font-size:12px">電燈</small></div>
</div>

<div id="task-modal">
    <h3 id="modal-title">任務內容</h3>
    <p>請點擊完成任務！</p>
    <button onclick="completeTask()">完成</button>
</div>

<audio id="rooster-sound" src="https://www.soundjay.com/nature/sounds/rooster-crowing-01.mp3"></audio>

<script>
    let finishedTasks = 0;
    let targetTasks = 3;
    let currentTaskItem = null;

    // 10 種可能的任務地點 (ID)
    const allTaskIds = ['desk', 'bath', 'window', 'toy', 'shelf', 'plant', 'closet', 'chair', 'carpet', 'mirror']; 
    // 注意：上面的 ID 必須在 HTML 中有對應的 div
    
    // 初始化遊戲：隨機挑選 3 個
    function initGame() {
        const shuffled = allTaskIds.sort(() => 0.5 - Math.random());
        const selected = shuffled.slice(0, 3);
        
        selected.forEach(id => {
            const el = document.getElementById(id);
            if(el) el.style.display = 'block';
        });

        // 監聽點擊
        document.querySelectorAll('.exclamation').forEach(item => {
            item.addEventListener('click', function() {
                if(this.id === 'light-switch' || this.id === 'bed') return; // 這兩個是特殊流程
                currentTaskItem = this;
                showModal(`處理${this.innerText}中的任務`);
            });
        });
    }

    function showModal(text) {
        document.getElementById('modal-title').innerText = text;
        document.getElementById('task-modal').style.display = 'block';
    }

    function completeTask() {
        document.getElementById('task-modal').style.display = 'none';
        if(currentTaskItem) {
            currentTaskItem.style.display = 'none';
            finishedTasks++;
            document.getElementById('count').innerText = finishedTasks;
            
            if(finishedTasks === targetTasks) {
                alert("任務全部完成！準備睡覺吧。");
                document.getElementById('light-switch').style.display = 'block';
                document.getElementById('light-switch').onclick = turnOffLight;
            }
        }
    }

    function turnOffLight() {
        document.getElementById('room-scene').classList.add('dark');
        this.style.display = 'none';
        document.getElementById('bed').style.display = 'block';
        document.getElementById('bed').onclick = goToSleep;
    }

    function goToSleep() {
        document.getElementById('room-scene').classList.add('sleep-mode');
        this.style.display = 'none';
        
        setTimeout(() => {
            document.getElementById('rooster-sound').play();
            document.getElementById('room-scene').classList.remove('sleep-mode', 'dark');
            alert("恭喜你！一夜好眠！");
        }, 3000);
    }

    initGame();
</script>
</body>
</html>
</script>
</body>
</html>
