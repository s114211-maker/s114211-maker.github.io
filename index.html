<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>任務房間</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f3f3f3;
      overflow: hidden;
    }
    #room {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: url('room-bg.png') center/cover no-repeat;
    }
    .obj {
      position: absolute;
      cursor: pointer;
    }
    .exmark {
      position: absolute;
      width: 40px;
      height: 40px;
      background: yellow;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
    }
    #taskWindow {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      display: none;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    #finishMessage {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #4caf50;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      display: none;
    }
    #taskCount {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 5px 10px;
      border-radius: 6px;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="taskCount">0/3</div>
  <div id="finishMessage">任務完成！</div>

  <div id="room">
    <!-- 景物與驚嘆號 -->
    <div id="desk" class="obj" style="top:60%; left:20%; width:150px; height:100px;"></div>
    <div id="deskMark" class="exmark" style="top:55%; left:25%; display:none;">!</div>

    <div id="bed" class="obj" style="top:65%; left:60%; width:200px; height:120px;"></div>
    <div id="bedMark" class="exmark" style="top:60%; left:68%; display:none;">!</div>

    <div id="window" class="obj" style="top:40%; left:70%; width:100px; height:150px;"></div>
    <div id="windowMark" class="exmark" style="top:35%; left:75%; display:none;">!</div>

    <div id="toy" class="obj" style="top:70%; left:40%; width:80px; height:80px;"></div>
    <div id="toyMark" class="exmark" style="top:65%; left:42%; display:none;">!</div>

    <div id="bookshelf" class="obj" style="top:20%; left:10%; width:120px; height:200px;"></div>
    <div id="bookshelfMark" class="exmark" style="top:15%; left:15%; display:none;">!</div>

    <div id="lamp" class="obj" style="top:10%; left:80%; width:60px; height:120px;"></div>
    <div id="lampMark" class="exmark" style="top:5%; left:82%; display:none;">!</div>

    <div id="chair" class="obj" style="top:60%; left:30%; width:60px; height:80px;"></div>
    <div id="chairMark" class="exmark" style="top:55%; left:32%; display:none;">!</div>

    <div id="closet" class="obj" style="top:25%; left:50%; width:100px; height:150px;"></div>
    <div id="closetMark" class="exmark" style="top:20%; left:52%; display:none;">!</div>

    <div id="mirror" class="obj" style="top:30%; left:30%; width:80px; height:150px;"></div>
    <div id="mirrorMark" class="exmark" style="top:25%; left:32%; display:none;">!</div>

    <div id="clock" class="obj" style="top:5%; left:50%; width:60px; height:60px;"></div>
    <div id="clockMark" class="exmark" style="top:0%; left:52%; display:none;">!</div>

    <button id="lampBtn" style="position:absolute; bottom:20px; right:20px;">燈</button>
  </div>

  <div id="taskWindow">
    <p id="taskText">任務內容</p>
    <button id="taskDone">完成</button>
  </div>

<script>
  const tasks = [
    { id: 'desk', mark: 'deskMark', text: '整理書桌' },
    { id: 'bed', mark: 'bedMark', text: '鋪床' },
    { id: 'window', mark: 'windowMark', text: '開窗透氣' },
    { id: 'toy', mark: 'toyMark', text: '整理玩具' },
    { id: 'bookshelf', mark: 'bookshelfMark', text: '整理書架' },
    { id: 'lamp', mark: 'lampMark', text: '開燈' },
    { id: 'chair', mark: 'chairMark', text: '擦椅子' },
    { id: 'closet', mark: 'closetMark', text: '整理衣櫃' },
    { id: 'mirror', mark: 'mirrorMark', text: '擦鏡子' },
    { id: 'clock', mark: 'clockMark', text: '調整鬧鐘' }
  ];

  let selectedTasks = [];
  let done = 0;

  function chooseRandomTasks() {
    const pool = [...tasks];
    while (selectedTasks.length < 3) {
      const i = Math.floor(Math.random() * pool.length);
      selectedTasks.push(pool.splice(i,1)[0]);
    }
  }

  chooseRandomTasks();

  selectedTasks.forEach(t => {
    const markEl = document.getElementById(t.mark);
    if (markEl) {
      markEl.style.display = 'flex';
      markEl.onclick = () => openTask(t);
    }
  });

  const taskWindow = document.getElementById('taskWindow');
  const taskText = document.getElementById('taskText');
  const taskDone = document.getElementById('taskDone');
  let currentTask = null;

  function openTask(t) {
    currentTask = t;
    taskText.textContent = t.text;
    taskWindow.style.display = 'block';
  }

  taskDone.onclick = () => {
    taskWindow.style.display = 'none';
    document.getElementById(currentTask.mark).style.display = 'none';
    done++;
    document.getElementById('taskCount').textContent = `${done}/3`;

    if (done === 3) {
      document.getElementById('finishMessage').style.display = 'block';
      document.getElementById('lampMark').style.display = 'flex';
    }
  };

  document.getElementById('lampMark').onclick = () => {
    document.body.style.background = '#000';
    setTimeout(() => {
      document.getElementById('bedMark').style.display = 'flex';
    }, 500);
  };

  document.getElementById('bedMark').onclick = () => {
    document.body.style.background = '#fff';
    alert('恭喜你！一夜好眠！');
  };
</script>
</body>
</html>
