<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第一視角：睡前任務互動報告</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; }

        /* 遊戲場景 */
        #game-world {
            position: relative;
            width: 100vw;
            height: 100vh;
            /* 使用剛才選定的 2D 房間圖 */
            background-image: url('https://i.imgur.com/vHq0F2r.png'); 
            background-size: cover;
            background-position: center;
            transition: filter 1.5s ease;
        }

        /* 任務計數器 */
        #hud {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 10px 25px;
            border-radius: 50px;
            font-size: 24px;
            z-index: 100;
        }

        /* 驚嘆號定位與樣式 */
        .exclamation {
            position: absolute;
            cursor: pointer;
            font-size: 45px;
            color: #FFD700;
            text-shadow: 0 0 10px #000;
            animation: bounce 0.6s infinite alternate;
            display: none; /* 預設隱藏，由 JS 隨機開啟 */
            text-align: center;
        }
        .exclamation small { display: block; font-size: 14px; color: white; background: rgba(0,0,0,0.5); border-radius: 5px; }

        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-15px); } }

        /* 各物件坐標 (根據 2D 圖片調整) */
        #task-desk     { top: 52%; left: 48%; }
        #task-bath     { top: 45%; left: 18%; }
        #task-toy      { top: 72%; left: 35%; }
        #task-trash    { top: 70%; left: 55%; }
        #task-window   { top: 25%; left: 45%; }
        #task-switch   { top: 48%; left: 30%; } /* 電燈開關 */
        #task-bed      { top: 80%; left: 75%; } /* 床 */

        /* 彈出視窗 */
        #modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        #modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            max-width: 300px;
        }
        button { padding: 10px 20px; font-size: 18px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 5px; }

        /* 狀態效果 */
        .night-filter { filter: brightness(0.3) contrast(1.2); }
        .sleep-filter { filter: brightness(0); }
    </style>
</head>
<body>

<div id="hud">任務進度: <span id="progress">0</span>/3</div>

<div id="game-world">
    <div id="task-desk" class="exclamation" onclick="openTask('書桌')">❗<small>整理書桌</small></div>
    <div id="task-bath" class="exclamation" onclick="openTask('浴室')">❗<small>刷牙洗臉</small></div>
    <div id="task-toy" class="exclamation" onclick="openTask('玩具')">❗<small>收好玩具</small></div>
    <div id="task-trash" class="exclamation" onclick="openTask('垃圾桶')">❗<small>倒垃圾</small></div>
    <div id="task-window" class="exclamation" onclick="openTask('窗戶')">❗<small>關窗戶</small></div>
    
    <div id="task-switch" class="exclamation" onclick="toggleLight()">❗<small>關燈</small></div>
    <div id="task-bed" class="exclamation" onclick="sleepNow()">❗<small>睡覺</small></div>
</div>

<div id="modal-overlay">
    <div id="modal-content">
        <h2 id="task-title">任務</h2>
        <p>確認完成這個項目嗎？</p>
        <button onclick="closeTask()">完成！</button>
    </div>
</div>

<audio id="rooster" src="https://assets.mixkit.co/sfx/preview/mixkit-rooster-crowing-in-the-morning-2435.mp3"></audio>

<script>
    let score = 0;
    let currentTask = "";

    // 1. 初始化：隨機挑選 3 個任務
    const allTasks = ['task-desk', 'task-bath', 'task-toy', 'task-trash', 'task-window'];
    const selected = allTasks.sort(() => 0.5 - Math.random()).slice(0, 3);
    
    selected.forEach(id => {
        document.getElementById(id).style.display = 'block';
    });

    // 2. 任務視窗邏輯
    function openTask(name) {
        currentTask = name;
        document.getElementById('task-title').innerText = name;
        document.getElementById('modal-overlay').style.display = 'flex';
    }

    function closeTask() {
        document.getElementById('modal-overlay').style.display = 'none';
        // 隱藏剛完成的任務
        const taskElements = document.getElementsByClassName('exclamation');
        for(let el of taskElements) {
            if(el.innerText.includes(currentTask)) {
                el.style.display = 'none';
                score++;
                break;
            }
        }
        document.getElementById('progress').innerText = score;

        // 3. 判斷是否完成所有 3 個任務
        if(score === 3) {
            setTimeout(() => {
                alert("任務全部完成！該去關燈睡覺了。");
                document.getElementById('task-switch').style.display = 'block';
            }, 500);
        }
    }

    // 4. 關燈邏輯
    function toggleLight() {
        document.getElementById('game-world').classList.add('night-filter');
        document.getElementById('task-switch').style.display = 'none';
        document.getElementById('task-bed').style.display = 'block';
    }

    // 5. 睡覺邏輯
    function sleepNow() {
        document.getElementById('game-world').classList.add('sleep-filter');
        document.getElementById('task-bed').style.display = 'none';
        
        setTimeout(() => {
            document.getElementById('rooster').play();
            document.getElementById('game-world').classList.remove('sleep-filter', 'night-filter');
            setTimeout(() => {
                alert("恭喜你！一夜好眠！");
                location.reload(); // 重新開始
            }, 500);
        }, 3000);
    }
</script>

</body>
</html>
