<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>互動房間任務</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #87ceeb;
    overflow: hidden;
  }
  #room {
    position: relative;
    width: 100vw;
    height: 100vh;
    background: linear-gradient(to top, #deb887 0%, #deb887 70%, #87ceeb 70%, #87ceeb 100%);
  }
  .obj {
    position: absolute;
    cursor: pointer;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
  }
  .exmark {
    position: absolute;
    width: 30px;
    height: 30px;
    background: yellow;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
  }
  #taskWindow {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 300px;
    background: white;
    padding: 20px;
    border-radius: 10px;
    display: none;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
  }
  #finishMessage {
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #4caf50;
    color: white;
    padding: 10px 20px;
    border-radius: 8px;
    display: none;
  }
  #taskCount {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 5px 10px;
    border-radius: 6px;
    font-size: 18px;
  }
</style>
</head>
<body>
<div id="taskCount">0/3</div>
<div id="finishMessage">任務完成！</div>
<div id="room">
  <!-- 房間景物方塊 -->
  <div id="desk" class="obj" style="top:60%; left:10%; width:150px; height:100px; background:#a52a2a;">書桌</div>
  <div id="bed" class="obj" style="top:65%; left:70%; width:200px; height:120px; background:#8b4513;">床</div>
  <div id="window" class="obj" style="top:30%; left:80%; width:100px; height:150px; background:#1e90ff;">窗戶</div>
  <div id="toy" class="obj" style="top:70%; left:40%; width:80px; height:80px; background:#ff69b4;">玩具</div>
  <div id="bookshelf" class="obj" style="top:10%; left:5%; width:120px; height:200px; background:#228B22;">書架</div>
  <div id="lamp" class="obj" style="top:10%; left:60%; width:60px; height:120px; background:#ffd700;">燈</div>
  <div id="chair" class="obj" style="top:60%; left:30%; width:60px; height:80px; background:#800080;">椅子</div>
  <div id="closet" class="obj" style="top:25%; left:50%; width:100px; height:150px; background:#a0522d;">衣櫃</div>
  <div id="mirror" class="obj" style="top:35%; left:30%; width:80px; height:150px; background:#708090;">鏡子</div>
  <div id="clock" class="obj" style="top:5%; left:50%; width:60px; height:60px; background:#FF8C00;">鐘</div>
</div>

<div id="taskWindow">
  <p id="taskText">任務內容</p>
  <button id="taskDone">完成</button>
</div>

<script>
const tasks = [
  { id:'desk', mark:'deskMark', text:'整理書桌'},
  { id:'bed', mark:'bedMark', text:'鋪床'},
  { id:'window', mark:'windowMark', text:'開窗透氣'},
  { id:'toy', mark:'toyMark', text:'整理玩具'},
  { id:'bookshelf', mark:'bookshelfMark', text:'整理書架'},
  { id:'lamp', mark:'lampMark', text:'開燈'},
  { id:'chair', mark:'chairMark', text:'擦椅子'},
  { id:'closet', mark:'closetMark', text:'整理衣櫃'},
  { id:'mirror', mark:'mirrorMark', text:'擦鏡子'},
  { id:'clock', mark:'clockMark', text:'調整鬧鐘'}
];

let selectedTasks = [];
let done = 0;

function chooseRandomTasks(){
  const pool = [...tasks];
  while(selectedTasks.length<3){
    const i = Math.floor(Math.random()*pool.length);
    selectedTasks.push(pool.splice(i,1)[0]);
  }
}
chooseRandomTasks();

selectedTasks.forEach(t=>{
  const markEl = document.createElement('div');
  markEl.className='exmark';
  markEl.textContent='!';
  markEl.style.display='flex';
  const objEl=document.getElementById(t.id);
  markEl.style.top=(objEl.offsetTop-15)+'px';
  markEl.style.left=(objEl.offsetLeft+objEl.offsetWidth-15)+'px';
  markEl.onclick=()=>openTask(t);
  markEl.id=t.mark;
  document.getElementById('room').appendChild(markEl);
});

const taskWindow=document.getElementById('taskWindow');
const taskText=document.getElementById('taskText');
const taskDone=document.getElementById('taskDone');
let currentTask=null;

function openTask(t){
  currentTask=t;
  taskText.textContent=t.text;
  taskWindow.style.display='block';
}

taskDone.onclick=()=>{
  taskWindow.style.display='none';
  document.getElementById(currentTask.mark).style.display='none';
  done++;
  document.getElementById('taskCount').textContent=`${done}/3`;
  if(done===3){
    const lamp=document.getElementById('lamp');
    const lampMark=document.createElement('div');
    lampMark.className='exmark';
    lampMark.textContent='!';
    lampMark.style.top=(lamp.offsetTop-15)+'px';
    lampMark.style.left=(lamp.offsetLeft+lamp.offsetWidth-15)+'px';
    lampMark.onclick=()=>{
      document.body.style.background='#000';
      lampMark.style.display='none';
      const bed=document.getElementById('bed');
      const bedSleepMark=document.createElement('div');
      bedSleepMark.className='exmark';
      bedSleepMark.textContent='!';
      bedSleepMark.style.top=(bed.offsetTop-15)+'px';
      bedSleepMark.style.left=(bed.offsetLeft+bed.offsetWidth-15)+'px';
      bedSleepMark.onclick=()=>{
        document.body.style.background='#87ceeb';
        alert('恭喜你！一夜好眠！');
        bedSleepMark.style.display='none';
      };
      document.getElementById('room').appendChild(bedSleepMark);
    };
    document.getElementById('room').appendChild(lampMark);
  }
};
</script>
</body>
</html>
